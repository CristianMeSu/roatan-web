---
import fs from "fs";
import path from "path";
import matter from "gray-matter";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header/Header.astro";
import Footer from "../../components/Footer/Footer.astro";
import Menu from "../../components/Header/Menu.astro";
const lang = Astro.params.lang || "es";

// Lee los archivos de posts
const postsDir = path.resolve(`./src/posts/${lang}`);
const files = fs.readdirSync(postsDir);

const posts = files.map((filename) => {
  const filePath = path.join(postsDir, filename);
  const fileContent = fs.readFileSync(filePath, "utf-8");
  const { data } = matter(fileContent);

  return {
    ...data,
    title: data.title || filename.replace(".md", ""),
    slug: data.slug || filename.replace(".md", ""),
    excerpt: data.excerpt || "",
  };
});
export function getStaticPaths() {
  return [{ params: { lang: "es" } }, { params: { lang: "en" } }];
}
---

<Layout lang={lang}>
<Menu lang={lang} />
<Header lang={lang} />
  
  <h1>{lang === "es" ? "Blog" : "Blog"}</h1>
  <ul>
    {posts.map(post => (
      <li>
        <a href={`/${lang}/blog/${post.slug}`}>
          <h2>{post.title}</h2>
          <p>{post.excerpt}</p>
        </a>
      </li>
    ))}
  </ul>
  <Footer lang={lang} />
</Layout>
